<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Snake — crash2-k</title>
  <style>
    :root { background:#0d1117; color:#00ff41; }
    html,body{height:100%;margin:0;font-family:monospace;background:#0d1117;color:#00ff41;display:flex;align-items:center;justify-content:center}
    .wrap{width:min(600px,90vw);}    
    canvas{display:block;background:#010409;border:4px solid #00ff41;border-radius:8px;width:100%;height:auto}
    .info{display:flex;justify-content:space-between;align-items:center;margin-top:10px}
    button{background:#00ff41;color:#001;border:none;padding:8px 12px;border-radius:6px;cursor:pointer;font-weight:700}
    .hint{font-size:13px;color:#9ff2b0}
  </style>
</head>
<body>
  <div class="wrap">
    <canvas id="game" width="600" height="600"></canvas>
    <div class="info">
      <div class="hint">Use arrow keys or WASD — Eat apples to grow</div>
      <div>
        <span id="score">Score: 0</span>
        <button id="restart">Restart</button>
      </div>
    </div>
  </div>

<script>
(() => {
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const size = 20; // cell size
  const cols = canvas.width / size;
  const rows = canvas.height / size;

  let snake = [{x: Math.floor(cols/2), y: Math.floor(rows/2)}];
  let dir = {x:1,y:0};
  let apple = {};
  let score = 0;
  let speed = 120; // ms
  let running = true;
  let loopId;

  function placeApple(){
    let ok = false;
    while(!ok){
      apple.x = Math.floor(Math.random()*cols);
      apple.y = Math.floor(Math.random()*rows);
      ok = !snake.some(s=>s.x===apple.x && s.y===apple.y);
    }
  }

  function draw(){
    ctx.fillStyle = '#010409';
    ctx.fillRect(0,0,canvas.width,canvas.height);

    // apple
    ctx.fillStyle = '#ff4d4d';
    ctx.fillRect(apple.x*size, apple.y*size, size, size);

    // snake
    for(let i=0;i<snake.length;i++){
      ctx.fillStyle = i===0 ? '#00ff41' : '#005f21';
      ctx.fillRect(snake[i].x*size, snake[i].y*size, size-1, size-1);
    }
  }

  function step(){
    if(!running) return;
    const head = {x: snake[0].x + dir.x, y: snake[0].y + dir.y};

    // wrap around
    head.x = (head.x + cols) % cols;
    head.y = (head.y + rows) % rows;

    // collision with self
    if(snake.some(s => s.x===head.x && s.y===head.y)){
      running = false;
      clearInterval(loopId);
      alert('Game over! Score: ' + score);
      return;
    }

    snake.unshift(head);

    // eat apple
    if(head.x===apple.x && head.y===apple.y){
      score += 1;
      document.getElementById('score').textContent = 'Score: ' + score;
      placeApple();
      // increase speed slightly
      if(speed>40){ speed -= 3; clearInterval(loopId); loopId = setInterval(step, speed); }
    } else {
      snake.pop();
    }

    draw();
  }

  function key(e){
    const k = e.key;
    const mapping = {
      ArrowUp: {x:0,y:-1}, ArrowDown:{x:0,y:1}, ArrowLeft:{x:-1,y:0}, ArrowRight:{x:1,y:0},
      w:{x:0,y:-1}, s:{x:0,y:1}, a:{x:-1,y:0}, d:{x:1,y:0}
    };
    if(mapping[k]){
      const nd = mapping[k];
      // prevent reverse
      if(snake.length>1 && nd.x===-dir.x && nd.y===-dir.y) return;
      dir = nd;
    }
  }

  document.addEventListener('keydown', key);
  document.getElementById('restart').addEventListener('click', ()=>{
    snake = [{x: Math.floor(cols/2), y: Math.floor(rows/2)}];
    dir = {x:1,y:0};
    score = 0; speed = 120; running = true; document.getElementById('score').textContent = 'Score: 0'; placeApple(); clearInterval(loopId); loopId = setInterval(step, speed);
  });

  // initialize
  placeApple();
  draw();
  loopId = setInterval(step, speed);
})();
</script>
</body>
</html>
